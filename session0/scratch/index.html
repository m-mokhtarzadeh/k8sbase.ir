<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Create Lab from scratch on Rocky linux 9 - Kubernetes Fundamental Documents</title><meta name=description content="Kubernetes Fundamental"><meta name=generator content="Hugo 0.119.0"><link href=https://k8sbase.ir//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://k8sbase.ir/session0/scratch/><link rel=stylesheet href=https://k8sbase.ir/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://k8sbase.ir/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://k8sbase.ir/js/bundle.js></script><style>:root{--custom-font-color:#a9a9b3;--custom-background-color:#292a2d}</style><meta property="og:title" content="Create Lab from scratch on Rocky linux 9"><meta property="og:description" content="Kubernetes Fundamental"><meta property="og:type" content="article"><meta property="og:url" content="https://k8sbase.ir/session0/scratch/"><meta property="og:image" content="https://k8sbase.ir/images/kops.jpg"><meta property="article:section" content="session0"><meta property="article:published_time" content="2022-12-11T15:26:15+00:00"><meta property="article:modified_time" content="2022-12-11T15:26:15+00:00"><meta property="og:site_name" content="Kubernetes Fundamental"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://k8sbase.ir/images/kops.jpg"><meta name=twitter:title content="Create Lab from scratch on Rocky linux 9"><meta name=twitter:description content="Kubernetes Fundamental"><meta itemprop=name content="Create Lab from scratch on Rocky linux 9"><meta itemprop=description content="Kubernetes Fundamental"><meta itemprop=datePublished content="2022-12-11T15:26:15+00:00"><meta itemprop=dateModified content="2022-12-11T15:26:15+00:00"><meta itemprop=wordCount content="299"><meta itemprop=image content="https://k8sbase.ir/images/kops.jpg"><meta itemprop=keywords content></head><body><div class=container><header><h1>Kubernetes Fundamental Documents</h1><p class=description>This Weblog Just Created For Kubernetes Fundamental Challenges</p></header><div class=global-menu><nav><ul><li><a href=/>Home</a></li><li><a href=https://m-mokhtarzadeh.ir/>About Me</a></li></ul></nav></div><div class=content-container><main><h1>Create Lab from scratch on Rocky linux 9</h1><h3 id=step-1-download-rocky-linux-9>Step 1: Download rocky linux 9</h3><p>Download rocky linux 9 from following repository:<br><a href=https://rockylinux.org/download>Rocky Linux download repository</a></p><h3 id=step-2-install-dependencies>Step 2: Install dependencies</h3><p>Remove Rocky default repository and Isfahan university repos:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf /etc/yum.repos.d/*
</span></span><span style=display:flex><span>cd /etc/yum.repos.d
</span></span><span style=display:flex><span>curl -O repo.iut.ac.ir/repo/iutrocky9.repo
</span></span><span style=display:flex><span>curl -O repo.iut.ac.ir/repo/iutepel9.repo
</span></span><span style=display:flex><span>dnf update
</span></span></code></pre></div><p>Install following dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dnf install vim gpm dhclient nano tar bzip2 kernel-headers kernel-devel open-vm-tools
</span></span></code></pre></div><p>Install Virutlabox extensions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount /dev/sr0 /mnt
</span></span><span style=display:flex><span>cd /mnt
</span></span><span style=display:flex><span>./VBoxLinuxAdditions.run
</span></span></code></pre></div><h3 id=step-3-disable-firewall>Step 3: Disable firewall</h3><p>Disable firewall:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span>systemctl mask firewalld
</span></span></code></pre></div><h3 id=step-4-disable-selinux>Step 4: Disable selinux</h3><p>Disable selinux:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -i s/^SELINUX<span style=color:#f92672>=</span>.*$/SELINUX<span style=color:#f92672>=</span>disabled/ /etc/selinux/config
</span></span></code></pre></div><h3 id=step-5-update-system-packages>Step 5: Update system packages</h3><p>Update system packages with following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dnf update
</span></span></code></pre></div><h3 id=step-6-install-latest-version-of-docker>Step 6: Install latest version of docker</h3><p>Add docker repository to server package repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</span></span></code></pre></div><p>Install docker packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf install docker-ce docker-ce-cli containerd.io
</span></span></code></pre></div><p>Enable and start docker service with following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start docker
</span></span><span style=display:flex><span>sudo systemctl enable docker
</span></span><span style=display:flex><span>sudo systemctl status docker
</span></span></code></pre></div><h3 id=step-7-pull-images-for-required-hands-on-lab>Step 7: Pull images for required hands-on lab</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull nginx
</span></span></code></pre></div><h3 id=step-9-configuring-system-for-kubernetes-installation>Step 9: Configuring System for kubernetes installation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>overlay
</span></span></span><span style=display:flex><span><span style=color:#e6db74>br_netfilter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo modprobe overlay
</span></span><span style=display:flex><span>sudo modprobe br_netfilter
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_forward = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl --system
</span></span></code></pre></div><p>Disable swap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>swapoff -a
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#e6db74>&#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab
</span></span><span style=display:flex><span><span style=color:#75715e># remove swap from /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#75715e># make sure swap in lvm mode removed from grub</span>
</span></span></code></pre></div><h3 id=step-10-install-kubernetes>Step 10: Install kubernetes</h3><p>Add kubernetes repository to system repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>exclude=kubelet kubeadm kubectl
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>Install kubernetes packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dnf install -y kubelet-1.27.6-0 kubeadm-1.27.6-0 kubectl-1.27.6-0 --disableexcludes<span style=color:#f92672>=</span>kubernetes
</span></span></code></pre></div><p>Enable kubernetes service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl enable kubelet
</span></span></code></pre></div><p>Pull kubernetes required container images:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm config images pull --kubernetes-version 1.27.6 --cri-socket /run/cri-dockerd.sock
</span></span><span style=display:flex><span>docker pull docker.io/calico/cni:v3.26.1
</span></span><span style=display:flex><span>docker pull docker.io/calico/kube-controllers:v3.26.1
</span></span><span style=display:flex><span>docker pull docker.io/calico/node:v3.26.1
</span></span></code></pre></div><p>Download required manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml -O
</span></span></code></pre></div><div class=edit-meta>Last updated on 11 Dec 2022<br>Published on 11 Dec 2022<br></div><nav class=pagination><a class="nav nav-prev" href=https://k8sbase.ir/session0/ title="Session 0"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - Session 0</a>
<a class="nav nav-next" href=https://k8sbase.ir/session0/ova/ title="Create Lab with OVA file">Next - Create Lab with OVA file <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://k8sbase.ir/>Home</a></li><li class="parent has-sub-menu"><a href=https://k8sbase.ir/session0/>Session 0<span class="mark opened">-</span></a><ul class=sub-menu><li class=active><a href=https://k8sbase.ir/session0/scratch/>Create Lab from scratch on Rocky linux 9</a></li><li><a href=https://k8sbase.ir/session0/ova/>Create Lab with OVA file</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>